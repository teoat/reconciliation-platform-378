

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      DATABASE_URL: "postgres://user:password@db:5432/reconciliation"
      # JWT Configuration
      JWT_SECRET: "your-super-secret-key-change-in-production"
      JWT_EXPIRATION: 86400 # 24 hours
      # OAuth2/OIDC Configuration (Google)
      GOOGLE_OAUTH_CLIENT_ID: ""
      GOOGLE_OAUTH_CLIENT_SECRET: ""
      GOOGLE_OAUTH_REDIRECT_URL: "http://localhost:8080/api/v2/auth/oauth/google/callback"
      # OAuth2/OIDC Configuration (GitHub)
      GITHUB_OAUTH_CLIENT_ID: ""
      GITHUB_OAUTH_CLIENT_SECRET: ""
      GITHUB_OAUTH_REDIRECT_URL: "http://localhost:8080/api/v2/auth/oauth/github/callback"
    depends_on:
      - db

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "80:80"
    environment:
      VITE_API_BASE_URL: "http://backend:8080/api/v2"
      VITE_GOOGLE_OAUTH_REDIRECT_URL: "http://localhost:3000/api/v2/auth/oauth/google/callback"
      VITE_GITHUB_OAUTH_REDIRECT_URL: "http://localhost:3000/api/v2/auth/oauth/github/callback"
      VITE_OPTIMIZELY_SDK_KEY: "your-optimizely-sdk-key"
    depends_on:
      - backend

  auth-server:
    build:
      context: .
      dockerfile: docker/auth-server.dockerfile
    ports:
      - "4000:4000"
    environment:
      DATABASE_URL: "postgres://user:password@db:5432/reconciliation"
      JWT_SECRET: "your-auth-server-secret-key-change-in-production"
    depends_on:
      - db

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: reconciliation
    volumes:
      - db_data:/var/lib/postgresql/data

volumes:
  db_data:
