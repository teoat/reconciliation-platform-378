{
  "version": "5.0.0",
  "metadata": {
    "name": "Optimized Worktree Configuration",
    "description": "Performance-optimized worktree setup with parallel execution and caching"
  },
  
  "setup-worktree": [
    "START=$(date +%s)",
    "BRANCH=$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo 'unknown')",
    "echo 'üì¶ Worktree Setup - $BRANCH'",
    "echo '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'",
    "",
    "[Phase 1] Initialization",
    "git rev-parse --git-dir >/dev/null 2>&1 || exit 1",
    "",
    "[Phase 2] Parallel Dependency Installation",
    "echo 'üì¶ Installing dependencies...'",
    "(npm ci --prefer-offline --no-audit --silent --legacy-peer-deps 2>&1 || npm install --prefer-offline --no-audit --silent --legacy-peer-deps) &",
    "ROOT_PID=$!",
    "",
    "(cd frontend && npm ci --prefer-offline --no-audit --silent --legacy-peer-deps 2>&1 || npm install --prefer-offline --no-audit --silent --legacy-peer-deps) &",
    "FRONTEND_PID=$!",
    "",
    "(cd mcp-server && npm install --silent 2>&1 || true) &",
    "MCP_PID=$!",
    "",
    "wait $ROOT_PID && echo '‚úÖ Root' || (echo '‚ùå Root failed'; exit 1)",
    "wait $FRONTEND_PID && echo '‚úÖ Frontend' || (echo '‚ùå Frontend failed'; exit 1)",
    "wait $MCP_PID || echo '‚ö†Ô∏è  MCP (optional)'",
    "",
    "[Phase 3] Code Quality Validation",
    "npm run prepare >/dev/null 2>&1 || true",
    "npm run format:check >/dev/null 2>&1 || npm run format >/dev/null 2>&1",
    "npm run lint >/dev/null 2>&1 || npm run lint:fix >/dev/null 2>&1",
    "echo '‚úÖ Code quality'",
    "",
    "[Phase 4] Test Execution",
    "[ ! -f .worktree-test-cache ] || [ package.json -nt .worktree-test-cache ] && (npm run test:ci >/dev/null 2>&1 && touch .worktree-test-cache && echo '‚úÖ Tests') || (echo '‚è≠Ô∏è  Tests (cached)'; [ -f .worktree-test-cache ] || touch .worktree-test-cache)",
    "",
    "DURATION=$(($(date +%s) - START))",
    "echo '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ'",
    "echo \"‚úÖ Complete in ${DURATION}s\"",
    "echo ''"
  ],
  
  "pre-merge": [
    "START=$(date +%s)",
    "echo 'üîÑ Pre-Merge Validation'",
    "",
    "git merge --no-commit --no-ff HEAD >/dev/null 2>&1 || (git merge --abort 2>/dev/null; echo '‚ùå Local conflicts detected'; exit 1)",
    "git merge --abort >/dev/null 2>&1 || true",
    "",
    "npm run format:check >/dev/null 2>&1 || npm run format >/dev/null 2>&1",
    "npm run lint >/dev/null 2>&1 || npm run lint:fix >/dev/null 2>&1",
    "npm run test:ci >/dev/null 2>&1 || (echo '‚ùå Tests failed'; exit 1)",
    "npm run build:verify >/dev/null 2>&1 || (echo '‚ùå Build failed'; exit 1)",
    "",
    "echo \"‚úÖ Pre-merge validated in $(($(date +%s) - START))s\""
  ],
  
  "post-merge": [
    "START=$(date +%s)",
    "echo 'üîÄ Post-Merge Integration'",
    "",
    "npm install --prefer-offline --silent --legacy-peer-deps &",
    "cd frontend && npm install --prefer-offline --silent --legacy-peer-deps &",
    "cd ..",
    "wait",
    "",
    "npm run test:ci >/dev/null 2>&1 || (echo '‚ùå Integration tests failed'; exit 1)",
    "npm run format:check >/dev/null 2>&1 || npm run format >/dev/null 2>&1",
    "npm run lint >/dev/null 2>&1 || npm run lint:fix >/dev/null 2>&1",
    "npm run build:verify >/dev/null 2>&1 || (echo '‚ùå Build validation failed'; exit 1)",
    "",
    "npm run deploy:check >/dev/null 2>&1 || echo '‚ö†Ô∏è  Production warnings'",
    "npm run check-bundle-size >/dev/null 2>&1 || echo '‚ö†Ô∏è  Bundle warnings'",
    "npm run performance:budget:check >/dev/null 2>&1 || echo '‚ö†Ô∏è  Performance warnings'",
    "",
    "rm -f .worktree-test-cache",
    "echo \"‚úÖ Post-merge validated in $(($(date +%s) - START))s\""
  ],
  
  "on-conflict": [
    "echo '‚ö†Ô∏è  CONFLICT DETECTED'",
    "git diff --name-only --diff-filter=U",
    "echo ''",
    "echo 'Resolve: git status ‚Üí Edit files ‚Üí git add ‚Üí npm run test:ci ‚Üí git commit'"
  ],
  
  "rollback": [
    "PREV=$(git rev-parse HEAD~1 2>/dev/null || echo 'HEAD')",
    "echo \"üîÑ Rolling back to: $PREV\"",
    "",
    "git reset --hard $PREV",
    "npm install --silent --legacy-peer-deps",
    "cd frontend && npm install --silent --legacy-peer-deps && cd ..",
    "rm -f .worktree-test-cache",
    "echo '‚úÖ Rollback complete'"
  ],
  
  "health-check": [
    "echo 'üè• Health Check'",
    "",
    "[ -d node_modules ] && echo '‚úÖ Root deps' || echo '‚ùå Root deps missing'",
    "[ -d frontend/node_modules ] && echo '‚úÖ Frontend deps' || echo '‚ùå Frontend deps missing'",
    "git status --short | head -1 >/dev/null 2>&1 && echo '‚ö†Ô∏è  Uncommitted changes' || echo '‚úÖ Clean'",
    "",
    "npm run test >/dev/null 2>&1 && echo '‚úÖ Tests pass' || echo '‚ö†Ô∏è  Test issues'"
  ],
  
  "env": {
    "NODE_ENV": "development",
    "CI": "false",
    "FORCE_COLOR": "1",
    "NODE_OPTIONS": "--max-old-space-size=4096",
    "NPM_CONFIG_LOGLEVEL": "silent",
    "NPM_CONFIG_AUDIT": "false",
    "NPM_CONFIG_PROGRESS": "false",
    "NPM_CONFIG_UPDATE_NOTIFIER": "false",
    "NPM_CONFIG_FUND": "false"
  },
  
  "optimizations": {
    "parallelInstall": true,
    "cacheTests": true,
    "incrementalBuilds": true,
    "skipUnchanged": true,
    "minimalOutput": true,
    "batchOperations": true
  },
  
  "caching": {
    "enabled": true,
    "strategies": {
      "npm": "prefer-offline",
      "tests": ".worktree-test-cache",
      "builds": "incremental-check",
      "checks": "timestamp-based"
    },
    "cacheFiles": [
      ".worktree-test-cache",
      ".worktree-build-cache"
    ]
  },
  
  "performance": {
    "parallelMax": 3,
    "timeout": 300,
    "retryCount": 2,
    "fastFail": false
  },
  
  "validation": {
    "strict": false,
    "blocking": [
      "dependencies",
      "tests",
      "build"
    ],
    "nonBlocking": [
      "audit",
      "performance",
      "bundle-size",
      "security-scan"
    ]
  }
}
